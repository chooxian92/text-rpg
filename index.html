<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>升级版文字RPG</title>
<style>
  body { font-family: "Microsoft YaHei"; background:#f0f0f0; color:#333; padding:20px; }
  #game { background:#fff; padding:20px; border-radius:10px; max-width:600px; margin:auto; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  button { margin:5px; padding:10px 15px; font-size:16px; border-radius:5px; cursor:pointer;}
  #status { margin-top:10px; font-size:14px; color:#555;}
</style>
</head>
<body>
<div id="game">
  <p id="story"></p>
  <div id="options"></div>
  <div id="status"></div>
</div>

<script>
  // 游戏状态
  const defaultState = {
    step: 'start',
    hp: 10,
    inventory: []
  };
  const state = JSON.parse(localStorage.getItem('rpgState')) || defaultState;

  const storyEl = document.getElementById('story');
  const optionsEl = document.getElementById('options');
  const statusEl = document.getElementById('status');

  function saveState() {
    localStorage.setItem('rpgState', JSON.stringify(state));
  }

  function renderStatus() {
    statusEl.innerText = `血量: ${state.hp} | 道具: ${state.inventory.join(', ') || '无'}`;
  }

  function addButton(text, nextStep) {
    const btn = document.createElement('button');
    btn.innerText = text;
    btn.onclick = () => {
      state.step = nextStep;
      updateState(nextStep);
      saveState();
      render();
    };
    optionsEl.appendChild(btn);
  }

  function updateState(step) {
    if(step === 'forest_left') {
      state.inventory.push('魔法药水');
    }
    if(step === 'forest_right') {
      state.hp -= 5;
    }
    if(step === 'restart') {
      Object.assign(state, defaultState);
    }
  }

  function render() {
    optionsEl.innerHTML = '';
    renderStatus();

    switch(state.step){
      case 'start':
        storyEl.innerText = '你醒来，发现自己站在一片神秘的森林中，前方有两条路：';
        addButton('走左边的小路', 'forest_left');
        addButton('走右边的小路', 'forest_right');
        break;

      case 'forest_left':
        storyEl.innerText = '你走上左边的小路，遇到一只友善的精灵，获得魔法药水。游戏继续…';
        addButton('返回起点', 'start');
        addButton('重新开始', 'restart');
        break;

      case 'forest_right':
        if(state.hp <= 0){
          storyEl.innerText = '你掉进陷阱，血量为0，游戏失败！';
          addButton('重新开始', 'restart');
        } else {
          storyEl.innerText = '你走上右边的小路，受伤了5点血量。';
          addButton('返回起点', 'start');
          addButton('重新开始', 'restart');
        }
        break;

      case 'restart':
        storyEl.innerText = '游戏已重置，欢迎重新开始！';
        addButton('开始游戏', 'start');
        break;
    }
  }

  render();
</script>
</body>
</html>
